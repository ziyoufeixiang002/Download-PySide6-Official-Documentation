name: Mirror Kotlin Site to Artifacts

on:
  # 允许手动触发工作流
  workflow_dispatch:
  # 也可以设置一个计划任务，例如每周运行一次 (可选)
  # schedule:
  #   - cron: '0 0 * * 0' # 每周日午夜运行

jobs:
  mirror:
    runs-on: ubuntu-latest

    steps:
    - name: Setup Environment
      run: |
        # 创建一个目录来存放镜像内容
        mkdir -p ./mirrored_site
        # 检查 wget 版本 (可选，用于调试)
        wget --version

    - name: Run Wget Mirror Command
      run: |
        cd ./mirrored_site
        wget \
          --recursive \
          --no-clobber \
          --page-requisites \
          --html-extension \
          --convert-links \
          --restrict-file-names=windows \
          --domains=kotlinlang.org \
          --no-parent \
          --reject="*.mp*,*.MP*,*.avi,*.AVI,*.mov,*.MOV,*.wmv,*.WMV,*.flv,*.FLV,*.m4v,*.M4V,*.m4a,*.M4A,*.mp3,*.MP3,*.wav,*.WAV,*.ogg,*.OGG,*.oga,*.OGA,*.opus,*.OPUS,*.jpg,*.JPG,*.jpeg,*.JPEG,*.png,*.PNG,*.gif,*.GIF,*.webp,*.WEBP,*.svg,*.SVG,*.ico,*.ICO,*.bmp,*.BMP" \
          --accept-regex="^https://kotlinlang\.org/(docs/|api/)" \
          --reject-regex="^https://kotlinlang\.org/api/.*?/(2\.[3-9]|[3-9])/|/index\.html$" \
          https://kotlinlang.org/

    - name: Upload Mirrored Site as Artifact
      uses: actions/upload-artifact@v4
      with:
        name: kotlin-site-mirror-$(date +%Y%m%d-%H%M%S) # 使用时间戳创建唯一的 artifact 名称
        path: ./mirrored_site/
        retention-days: 30 # 可选：设置 Artifacts 保留天数
